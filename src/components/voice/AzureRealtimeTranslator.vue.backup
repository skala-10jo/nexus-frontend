<template>
  <div class="azure-realtime-translator">
    <!-- 헤더 -->
    <TranslatorHeader
      :recognized-count="recognizedCount"
      :formatted-elapsed-time="formattedElapsedTime"
    />

    <!-- 에러 배너 -->
    <TranslatorErrorBanner
      :speech-error="speechError"
      :tts-error="ttsError"
      @clear="handleClearErrors"
    />

    <!-- 언어 및 음성 선택 -->
    <TranslatorLanguageSelector
      v-model:selected-from-language="selectedFromLanguage"
      v-model:selected-to-language="selectedToLanguage"
      v-model:selected-voice="selectedVoice"
      :is-recognizing="isRecognizing"
      :supported-languages="SUPPORTED_LANGUAGES"
      :translation-languages="TRANSLATION_LANGUAGES"
      :available-voices="availableVoices"
      @update:selected-from-language="handleLanguageChange"
      @update:selected-to-language="handleLanguageChange"
    />

    <!-- 텍스트 카드 (원본 / 번역) -->
    <TranslatorTextCards
      :is-connecting="isConnecting"
      :is-recognizing="isRecognizing"
      :full-original-text="fullOriginalText"
      :full-translated-text="fullTranslatedText"
      :final-text="finalText"
      :partial-text="partialText"
      :final-translation="finalTranslation"
      :partial-translation="partialTranslation"
      :from-language-label="fromLanguageLabel"
      :to-language-label="toLanguageLabel"
    />

    <!-- 컨트롤 버튼 -->
    <TranslatorControls
      :is-connecting="isConnecting"
      :is-recognizing="isRecognizing"
      :is-speaking="isSpeaking"
      :final-text="finalText"
      :final-translation="finalTranslation"
      :recognized-count="recognizedCount"
      @toggle-recording="handleToggleRecording"
      @play-translation="handlePlayTranslation"
      @clear-all="handleClearAll"
      @export-results="handleExportResults"
    />

    <!-- 고급 설정 (접이식) -->
    <TranslatorAdvancedSettings
      v-model:show-advanced="showAdvanced"
      v-model:phrase-list-input="phraseListInput"
      :vad-silence-timeout="vadSilenceTimeout"
      :is-recognizing="isRecognizing"
      @update-vad="handleUpdateVAD"
      @update-phrase-list="handleUpdatePhraseList"
    />
  </div>
</template>

<script setup>
import { onMounted, onBeforeUnmount } from 'vue'
import { useAzureTranslator } from '../../composables/voice/useAzureTranslator'
import TranslatorHeader from './translator/TranslatorHeader.vue'
import TranslatorErrorBanner from './translator/TranslatorErrorBanner.vue'
import TranslatorLanguageSelector from './translator/TranslatorLanguageSelector.vue'
import TranslatorTextCards from './translator/TranslatorTextCards.vue'
import TranslatorControls from './translator/TranslatorControls.vue'
import TranslatorAdvancedSettings from './translator/TranslatorAdvancedSettings.vue'

// Composable로 모든 로직 위임
const {
  // State
  selectedFromLanguage,
  selectedToLanguage,
  selectedVoice,
  showAdvanced,
  phraseListInput,

  // Azure Speech State
  isRecognizing,
  isConnecting,
  speechError,
  partialText,
  finalText,
  partialTranslation,
  finalTranslation,
  fullOriginalText,
  fullTranslatedText,
  recognizedCount,
  vadSilenceTimeout,

  // Azure TTS State
  isSpeaking,
  ttsError,

  // Computed
  availableVoices,
  fromLanguageLabel,
  toLanguageLabel,
  formattedElapsedTime,

  // Constants
  SUPPORTED_LANGUAGES,
  TRANSLATION_LANGUAGES,

  // Actions
  handleLanguageChange,
  handleToggleRecording,
  handlePlayTranslation,
  handleClearAll,
  handleClearErrors,
  handleUpdateVAD,
  handleUpdatePhraseList,
  handleExportResults,
  initializeTranslator,
  cleanup
} = useAzureTranslator()

// 초기화
onMounted(() => {
  initializeTranslator()
})

// 정리
onBeforeUnmount(() => {
  cleanup()
})
</script>

<style scoped>
/* 전체 컨테이너 */
.azure-realtime-translator {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}
</style>
            v-for="lang in SUPPORTED_LANGUAGES"
            :key="lang.code"
            :value="lang.code"
          >
            {{ lang.flag }} {{ lang.label }}
          </option>
        </select>
      </div>

      <!-- 화살표 -->
      <div class="arrow-icon">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
      </div>

      <!-- 출력 언어 -->
      <div class="selector-group">
        <label class="selector-label">출력 언어</label>
        <select
          v-model="selectedToLanguage"
          @change="onLanguageChange"
          :disabled="isRecognizing"
          class="language-select"
        >
          <option
            v-for="lang in TRANSLATION_LANGUAGES"
            :key="lang.code"
            :value="lang.code"
          >
            {{ lang.label }}
          </option>
        </select>
      </div>

      <!-- 음성 선택 -->
      <div class="selector-group">
        <label class="selector-label">음성 (TTS)</label>
        <select
          v-model="selectedVoice"
          :disabled="availableVoices.length === 0"
          class="voice-select"
        >
          <option
            v-for="voice in availableVoices"
            :key="voice.value"
            :value="voice.value"
          >
            {{ voice.label }}
          </option>
        </select>
      </div>
    </div>

    <!-- 텍스트 카드 (원본 / 번역) -->
    <div class="text-cards">
      <!-- 원본 텍스트 -->
      <div class="text-card">
        <div class="card-header">
          <h3 class="card-title">원본 ({{ fromLanguageLabel }})</h3>
          <span v-if="fullOriginalText" class="text-length">{{ fullOriginalText.length }} 자</span>
        </div>
        <div class="card-content">
          <div v-if="isConnecting" class="loading-state">
            <div class="spinner"></div>
            <p>Azure Speech 연결 중...</p>
          </div>
          <div v-else-if="!fullOriginalText && !isRecognizing" class="empty-state">
            <svg class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
            <p>녹음 버튼을 눌러 음성 인식을 시작하세요</p>
          </div>
          <div v-else class="text-content">
            <!-- Final 텍스트 -->
            <span v-if="finalText" class="final-text">{{ finalText }}</span>
            <!-- Partial 텍스트 -->
            <span v-if="partialText" class="partial-text">{{ partialText }}</span>
            <!-- 커서 -->
            <span v-if="isRecognizing && partialText" class="cursor">|</span>
          </div>
        </div>
      </div>

      <!-- 번역 텍스트 -->
      <div class="text-card">
        <div class="card-header">
          <h3 class="card-title">번역 ({{ toLanguageLabel }})</h3>
          <span v-if="fullTranslatedText" class="text-length">{{ fullTranslatedText.length }} 자</span>
        </div>
        <div class="card-content">
          <div v-if="isConnecting" class="loading-state">
            <div class="spinner"></div>
            <p>준비 중...</p>
          </div>
          <div v-else-if="!fullTranslatedText && !isRecognizing" class="empty-state">
            <svg class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
            </svg>
            <p>번역된 텍스트가 여기에 표시됩니다</p>
          </div>
          <div v-else class="text-content">
            <!-- Final 번역 -->
            <span v-if="finalTranslation" class="final-text">{{ finalTranslation }}</span>
            <!-- Partial 번역 -->
            <span v-if="partialTranslation" class="partial-text">{{ partialTranslation }}</span>
            <!-- 커서 -->
            <span v-if="isRecognizing && partialTranslation" class="cursor">|</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 컨트롤 버튼 -->
    <div class="controls">
      <!-- 녹음 버튼 -->
      <button
        @click="toggleRecording"
        :class="['record-button', { 'recording': isRecognizing }]"
        :disabled="isConnecting"
      >
        <div class="record-button-inner">
          <svg v-if="!isRecognizing" class="button-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
          </svg>
          <svg v-else class="button-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
          </svg>
          <span>{{ isRecognizing ? '중지' : '녹음 시작' }}</span>
        </div>
        <div v-if="isRecognizing" class="pulse-ring"></div>
      </button>

      <!-- TTS 재생 버튼 -->
      <button
        @click="playTranslation"
        :disabled="!finalTranslation || isSpeaking || isRecognizing"
        class="secondary-button"
      >
        <svg v-if="!isSpeaking" class="button-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
        <svg v-else class="button-icon animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
        <span>{{ isSpeaking ? '재생 중...' : '번역 듣기' }}</span>
      </button>

      <!-- 지우기 버튼 -->
      <button
        @click="clearAll"
        :disabled="isRecognizing || (!finalText && !finalTranslation)"
        class="secondary-button"
      >
        <svg class="button-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        <span>지우기</span>
      </button>

      <!-- 내보내기 버튼 -->
      <button
        @click="exportResults"
        :disabled="recognizedSentences.length === 0"
        class="secondary-button"
      >
        <svg class="button-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg>
        <span>내보내기 (JSON)</span>
      </button>
    </div>

    <!-- 고급 설정 (접이식) -->
    <div class="advanced-settings">
      <button @click="showAdvanced = !showAdvanced" class="advanced-toggle">
        <svg :class="['toggle-icon', { 'rotated': showAdvanced }]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
        <span>고급 설정</span>
      </button>

      <div v-show="showAdvanced" class="advanced-content">
        <!-- VAD 침묵 시간 조절 -->
        <div class="setting-item">
          <label class="setting-label">
            <span>침묵 감지 시간 (VAD)</span>
            <span class="setting-value">{{ vadSilenceTimeout }}ms</span>
          </label>
          <input
            type="range"
            v-model.number="vadSilenceTimeout"
            @input="updateVAD"
            min="700"
            max="1500"
            step="100"
            :disabled="isRecognizing"
            class="setting-slider"
          />
          <p class="setting-hint">
            짧게(700ms): 빠른 응답, 문장이 잘릴 수 있음 | 길게(1500ms): 긴 문장 인식, 응답 지연
          </p>
        </div>

        <!-- Phrase List -->
        <div class="setting-item">
          <label class="setting-label">전문 용어 (Phrase List)</label>
          <textarea
            v-model="phraseListInput"
            @blur="updatePhraseList"
            :disabled="isRecognizing"
            placeholder="쉼표로 구분하여 입력 (예: 네이버, 카카오, SKT, AI, ChatGPT)"
            class="setting-textarea"
            rows="3"
          ></textarea>
          <p class="setting-hint">
            인식률을 높이고 싶은 단어나 고유명사를 입력하세요
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch, onMounted, onBeforeUnmount } from 'vue'
import { useAzureSpeech } from '../../composables/useAzureSpeech'
import { useAzureTTS } from '../../composables/useAzureTTS'
import {
  SUPPORTED_LANGUAGES,
  TRANSLATION_LANGUAGES,
  getVoicesForLanguage,
  getDefaultVoice,
  recognitionToTranslation,
  translationToTTS
} from '../../config/azureSpeechConfig'

// Composables
const {
  isInitialized,
  isRecognizing,
  isConnecting,
  error: speechError,
  partialText,
  finalText,
  partialTranslation,
  finalTranslation,
  recognizedSentences,
  translatedSentences,
  fullOriginalText,
  fullTranslatedText,
  recognizedCount,
  fromLanguage,
  toLanguage,
  vadSilenceTimeout,
  phraseList,
  initialize,
  startRecognition,
  stopRecognition,
  updateVADSettings,
  addPhrases,
  clearPhrases,
  clearResults,
  dispose: disposeAzureSpeech
} = useAzureSpeech()

const {
  isSpeaking,
  error: ttsError,
  speak,
  stop: stopTTS,
  dispose: disposeAzureTTS
} = useAzureTTS()

// 언어 선택
const selectedFromLanguage = ref('ko-KR')
const selectedToLanguage = ref('en')
const selectedVoice = ref('')

// UI 상태
const showAdvanced = ref(false)
const phraseListInput = ref('')
const startTime = ref(null)
const elapsedTime = ref(0)
let timerInterval = null

// 사용 가능한 음성 목록
const availableVoices = computed(() => {
  const ttsLang = translationToTTS(selectedToLanguage.value)
  return getVoicesForLanguage(ttsLang)
})

// 언어 레이블
const fromLanguageLabel = computed(() => {
  const lang = SUPPORTED_LANGUAGES.find(l => l.code === selectedFromLanguage.value)
  return lang ? lang.label : selectedFromLanguage.value
})

const toLanguageLabel = computed(() => {
  const lang = TRANSLATION_LANGUAGES.find(l => l.code === selectedToLanguage.value)
  return lang ? lang.label : selectedToLanguage.value
})

// 경과 시간 포맷
const formattedElapsedTime = computed(() => {
  const seconds = Math.floor(elapsedTime.value / 1000)
  const mins = Math.floor(seconds / 60)
  const secs = seconds % 60
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
})

// 언어 변경 시
async function onLanguageChange() {
  if (isRecognizing.value) {
    return
  }

  // 음성 목록 업데이트
  const voices = availableVoices.value
  if (voices.length > 0) {
    selectedVoice.value = voices[0].value
  }

  // 초기화되어 있으면 재초기화
  if (isInitialized.value) {
    await disposeAzureSpeech()
    await initialize(selectedFromLanguage.value, selectedToLanguage.value)
  }
}

// 녹음 토글
async function toggleRecording() {
  if (isRecognizing.value) {
    await stopRecognition()
    stopTimer()
  } else {
    // 초기화되지 않았으면 초기화
    if (!isInitialized.value) {
      await initialize(selectedFromLanguage.value, selectedToLanguage.value)
    }

    await startRecognition()
    startTimer()
  }
}

// 번역 재생
async function playTranslation() {
  if (!finalTranslation.value) {
    return
  }

  try {
    await speak(finalTranslation.value, selectedVoice.value)
  } catch (error) {
    console.error('TTS 재생 실패:', error)
  }
}

// 전체 지우기
function clearAll() {
  clearResults()
  stopTimer()
  elapsedTime.value = 0
}

// 에러 지우기
function clearErrors() {
  speechError.value = null
  ttsError.value = null
}

// VAD 업데이트
function updateVAD() {
  updateVADSettings(vadSilenceTimeout.value)
}

// Phrase List 업데이트
function updatePhraseList() {
  if (!phraseListInput.value.trim()) {
    clearPhrases()
    return
  }

  const phrases = phraseListInput.value
    .split(',')
    .map(p => p.trim())
    .filter(p => p.length > 0)

  clearPhrases()
  if (phrases.length > 0) {
    addPhrases(phrases)
  }
}

// 타이머 시작
function startTimer() {
  startTime.value = Date.now()
  timerInterval = setInterval(() => {
    elapsedTime.value = Date.now() - startTime.value
  }, 1000)
}

// 타이머 중지
function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval)
    timerInterval = null
  }
}

// 결과 내보내기
function exportResults() {
  const data = {
    fromLanguage: selectedFromLanguage.value,
    toLanguage: selectedToLanguage.value,
    voice: selectedVoice.value,
    timestamp: new Date().toISOString(),
    elapsedTime: elapsedTime.value,
    original: {
      text: finalText.value,
      sentences: recognizedSentences.value
    },
    translated: {
      text: finalTranslation.value,
      sentences: translatedSentences.value
    }
  }

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `voice-translation-${Date.now()}.json`
  a.click()
  URL.revokeObjectURL(url)
}

// 초기화
onMounted(() => {
  // 기본 음성 설정
  const voices = availableVoices.value
  if (voices.length > 0) {
    selectedVoice.value = voices[0].value
  }
})

// 정리
onBeforeUnmount(() => {
  stopTimer()
  disposeAzureSpeech()
  disposeAzureTTS()
})

// 출력 언어 변경 시 음성 자동 업데이트
watch(availableVoices, (newVoices) => {
  if (newVoices.length > 0 && !newVoices.find(v => v.value === selectedVoice.value)) {
    selectedVoice.value = newVoices[0].value
  }
})
</script>

<style scoped>
/* 전체 컨테이너 */
.azure-realtime-translator {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* 헤더 */
.translator-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 32px;
}

.title {
  font-size: 24px;
  font-weight: 600;
  color: #37352F;
  margin: 0 0 4px 0;
}

.subtitle {
  font-size: 14px;
  color: #6B6B6B;
  margin: 0;
}

/* 통계 */
.stats {
  display: flex;
  gap: 24px;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.stat-label {
  font-size: 12px;
  color: #6B6B6B;
  margin-bottom: 4px;
}

.stat-value {
  font-size: 20px;
  font-weight: 600;
  color: #37352F;
}

/* 에러 배너 */
.error-banner {
  display: flex;
  align-items: center;
  gap: 12px;
  background: #FEF2F2;
  border: 1px solid #FCA5A5;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 24px;
}

.error-icon {
  width: 24px;
  height: 24px;
  color: #DC2626;
  flex-shrink: 0;
}

.error-title {
  font-size: 14px;
  font-weight: 600;
  color: #991B1B;
  margin: 0 0 4px 0;
}

.error-message {
  font-size: 13px;
  color: #DC2626;
  margin: 0;
}

.error-close {
  margin-left: auto;
  padding: 4px;
  background: none;
  border: none;
  cursor: pointer;
  color: #DC2626;
}

.error-close svg {
  width: 20px;
  height: 20px;
}

/* 언어 선택 섹션 */
.language-selector-section {
  display: grid;
  grid-template-columns: 1fr auto 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
  align-items: end;
}

.selector-group {
  display: flex;
  flex-direction: column;
}

.selector-label {
  font-size: 12px;
  font-weight: 500;
  color: #6B6B6B;
  margin-bottom: 8px;
}

.language-select,
.voice-select {
  padding: 10px 12px;
  border: 1px solid #E9E9E7;
  border-radius: 6px;
  font-size: 14px;
  color: #37352F;
  background: white;
  cursor: pointer;
  transition: border-color 0.2s;
}

.language-select:hover:not(:disabled),
.voice-select:hover:not(:disabled) {
  border-color: #0070F3;
}

.language-select:disabled,
.voice-select:disabled {
  background: #F7F6F3;
  cursor: not-allowed;
}

.arrow-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6B6B6B;
}

.arrow-icon svg {
  width: 24px;
  height: 24px;
}

/* 텍스트 카드 */
.text-cards {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 24px;
}

.text-card {
  background: white;
  border: 1px solid #E9E9E7;
  border-radius: 8px;
  overflow: hidden;
  min-height: 300px;
  display: flex;
  flex-direction: column;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border-bottom: 1px solid #E9E9E7;
  background: #F7F6F3;
}

.card-title {
  font-size: 14px;
  font-weight: 600;
  color: #37352F;
  margin: 0;
}

.text-length {
  font-size: 12px;
  color: #6B6B6B;
}

.card-content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
}

/* 로딩 상태 */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 12px;
  color: #6B6B6B;
}

.spinner {
  width: 32px;
  height: 32px;
  border: 3px solid #E9E9E7;
  border-top-color: #0070F3;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* 빈 상태 */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 12px;
  color: #6B6B6B;
}

.empty-icon {
  width: 48px;
  height: 48px;
  color: #D1D1CF;
}

/* 텍스트 컨텐츠 */
.text-content {
  font-size: 16px;
  line-height: 1.6;
  color: #37352F;
  white-space: pre-wrap;
  word-break: break-word;
}

.final-text {
  font-weight: 600;
}

.partial-text {
  color: #6B6B6B;
  font-style: italic;
}

.cursor {
  animation: blink 1s infinite;
  margin-left: 2px;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

/* 컨트롤 버튼 */
.controls {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-bottom: 24px;
}

.record-button {
  position: relative;
  padding: 16px 32px;
  background: white;
  border: 2px solid #E9E9E7;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 16px;
  font-weight: 600;
  color: #37352F;
}

.record-button:hover:not(:disabled) {
  border-color: #0070F3;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 112, 243, 0.2);
}

.record-button.recording {
  background: #DC2626;
  border-color: #DC2626;
  color: white;
}

.record-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.record-button-inner {
  display: flex;
  align-items: center;
  gap: 8px;
}

.button-icon {
  width: 24px;
  height: 24px;
}

.pulse-ring {
  position: absolute;
  inset: -4px;
  border: 2px solid #DC2626;
  border-radius: 12px;
  animation: pulse 1.5s ease-out infinite;
}

@keyframes pulse {
  0% {
    opacity: 1;
    transform: scale(1);
  }
  100% {
    opacity: 0;
    transform: scale(1.1);
  }
}

.secondary-button {
  padding: 12px 24px;
  background: white;
  border: 1px solid #E9E9E7;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
  font-weight: 500;
  color: #37352F;
  display: flex;
  align-items: center;
  gap: 8px;
}

.secondary-button:hover:not(:disabled) {
  border-color: #0070F3;
  color: #0070F3;
}

.secondary-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* 고급 설정 */
.advanced-settings {
  background: white;
  border: 1px solid #E9E9E7;
  border-radius: 8px;
  overflow: hidden;
}

.advanced-toggle {
  width: 100%;
  padding: 16px;
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  font-weight: 500;
  color: #37352F;
}

.toggle-icon {
  width: 20px;
  height: 20px;
  transition: transform 0.3s;
}

.toggle-icon.rotated {
  transform: rotate(180deg);
}

.advanced-content {
  padding: 0 16px 16px 16px;
  border-top: 1px solid #E9E9E7;
}

.setting-item {
  padding: 16px 0;
  border-bottom: 1px solid #E9E9E7;
}

.setting-item:last-child {
  border-bottom: none;
}

.setting-label {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  font-weight: 500;
  color: #37352F;
  margin-bottom: 12px;
}

.setting-value {
  font-weight: 600;
  color: #0070F3;
}

.setting-slider {
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: #E9E9E7;
  outline: none;
  -webkit-appearance: none;
  appearance: none;
}

.setting-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #0070F3;
  cursor: pointer;
}

.setting-slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #0070F3;
  cursor: pointer;
  border: none;
}

.setting-textarea {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #E9E9E7;
  border-radius: 6px;
  font-size: 13px;
  color: #37352F;
  font-family: inherit;
  resize: vertical;
}

.setting-textarea:focus {
  outline: none;
  border-color: #0070F3;
}

.setting-hint {
  font-size: 12px;
  color: #6B6B6B;
  margin: 8px 0 0 0;
  line-height: 1.5;
}

/* 반응형 */
@media (max-width: 1024px) {
  .text-cards {
    grid-template-columns: 1fr;
  }

  .language-selector-section {
    grid-template-columns: 1fr;
  }

  .arrow-icon {
    display: none;
  }
}
</style>
